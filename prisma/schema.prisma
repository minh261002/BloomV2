// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

enum Role {
  ADMIN
  USER
}

model User {
  id            String        @id
  name          String        @db.Text
  email         String
  emailVerified Boolean       @default(false)
  image         String?       @db.Text
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  role          Role          @default(USER)
  banned        Boolean?      @default(false)
  banReason     String?       @db.Text
  banExpires    DateTime?
  sessions      Session[]
  accounts      Account[]
  userAddresses UserAddress[]

  @@unique([email])
  @@map("user")
}

model Session {
  id             String   @id
  expiresAt      DateTime
  token          String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  ipAddress      String?  @db.Text
  userAgent      String?  @db.Text
  userId         String
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  impersonatedBy String?  @db.Text

  @@unique([token])
  @@index([userId(length: 191)])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String    @db.Text
  providerId            String    @db.Text
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?   @db.Text
  refreshToken          String?   @db.Text
  idToken               String?   @db.Text
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?   @db.Text
  password              String?   @db.Text
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId(length: 191)])
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String   @db.Text
  value      String   @db.Text
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier(length: 191)])
  @@map("verification")
}

enum AddressType {
  HOME
  WORK
  OTHER
}

model UserAddress {
  id           String      @id
  userId       String
  user         User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  address      String      @db.Text
  provinceCode String      @map("province_code")
  wardCode     String      @map("ward_code")
  province     Province    @relation(fields: [provinceCode], references: [provinceCode], onDelete: Cascade)
  ward         Ward        @relation(fields: [wardCode], references: [wardCode], onDelete: Cascade)
  type         AddressType @default(HOME)
  isDefault    Boolean     @default(false)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  @@index([userId])
  @@index([provinceCode])
  @@index([wardCode])
  @@map("user_addresses")
}

model Province {
  id           BigInt    @id
  provinceCode String    @unique @map("province_code") @db.VarChar(2)
  name         String    @db.VarChar(255)
  shortName    String    @map("short_name") @db.VarChar(255)
  code         String    @db.VarChar(5)
  placeType    String    @map("place_type") @db.VarChar(255)
  country      String    @db.VarChar(10)
  createdAt    DateTime? @map("created_at")
  updatedAt    DateTime? @map("updated_at")

  wards         Ward[]
  userAddresses UserAddress[]

  @@map("provinces")
}

model Ward {
  id           BigInt    @id @default(autoincrement())
  wardCode     String    @unique @map("ward_code") @db.VarChar(6)
  name         String    @db.VarChar(255)
  provinceCode String    @map("province_code") @db.VarChar(2)
  createdAt    DateTime? @map("created_at")
  updatedAt    DateTime? @map("updated_at")

  province      Province      @relation(fields: [provinceCode], references: [provinceCode], onDelete: Cascade)
  userAddresses UserAddress[]

  @@index([provinceCode])
  @@map("wards")
}

enum ActiveStatus {
  ACTIVE
  INACTIVE
}

model Category {
  id          String       @id @default(uuid())
  name        String
  slug        String       @unique
  description String?      @db.Text
  image       String?      @db.Text
  featured    Boolean      @default(false)
  status      ActiveStatus @default(ACTIVE)
  sortOrder   Int          @default(0)

  // SEO
  metaTitle       String? @db.Text
  metaDescription String? @db.Text
  metaKeywords    String? @db.Text

  // Self-referencing for subcategories
  parentId String?
  parent   Category?  @relation("CategoryToSubcategories", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  children Category[] @relation("CategoryToSubcategories")

  collections Collection[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([parentId])
  @@index([status])
  @@index([featured])
  @@index([slug])
  @@map("categories")
}

model Collection {
  id          String       @id @default(uuid())
  name        String
  slug        String       @unique
  description String?      @db.Text
  image       String?      @db.Text
  featured    Boolean      @default(false)
  status      ActiveStatus @default(ACTIVE)
  sortOrder   Int          @default(0)

  // SEO
  metaTitle       String? @db.Text
  metaDescription String? @db.Text
  metaKeywords    String? @db.Text

  // Relationships
  categoryId String?
  category   Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([categoryId])
  @@index([status])
  @@index([featured])
  @@index([slug])
  @@map("collections")
}

model Brand {
  id          String  @id @default(uuid())
  name        String
  slug        String  @unique
  description String? @db.Text
  logo        String? @db.Text
  website     String?
  featured    Boolean @default(false)
  sortOrder   Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
  @@index([featured])
  @@map("brands")
}
